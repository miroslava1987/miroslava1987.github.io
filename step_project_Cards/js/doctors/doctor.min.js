import{deleteCard}from"../ajax/ajax.js";class Visit{constructor(t){this.doctor=t.doctor,this.title=t.purpose,this.description=t.description,this.priority=t.time,this.id=t.id,this.content={},this.content.patientFullName=t.name,this.content.visitDate=t["date-visit"],this.status=new Date<new Date(this.content.visitDate)?"Открыт":"Завершен",this._visitCard=null}render(t){const i=document.querySelector(".visit"),s=document.querySelector(".visit__title");s&&s.classList.add("hidden");const e=document.createElement("div");e.classList.add("visit-cards"),e.id=this.id,this._visitCard=e,e.innerHTML=`\n            <div class="visit-cards__doctor">\n                <span class="visit-cards__doctor-title">${this.doctor}</span>\n            </div>\n            <div class="visit-cards__patient">\n                <div class="visit-cards__patient-name">\n                    <span class="visit-cards__patient-name-label">ФИО пациента:</span>\n                    <span class="visit-cards__patient-name-name">${this.content.patientFullName}</span>\n                </div>\n                <div class="visit-cards__patient-title hide">\n                    <span class="visit-cards__patient-title-label">Цель визита</span>\n                    <span class="visit-cards__patient-title-subtitle">${this.title}</span>\n                </div>\n                <div class="visit-cards__patient-description hide">\n                    <span class="visit-cards__patient-description-label">Краткое описание визита</span>\n                    <span class="visit-cards__patient-description-info">${this.description}</span>\n                </div>\n                <div class="visit-cards__patient-priority hide">\n                    <span class="visit-cards__patient-priority-label">Срочность визита</span>\n                    <span class="visit-cards__patient-priority-info">${this.priority}</span>\n                </div>\n                <div class="visit-cards__patient-status hide">\n                    <span class="visit-cards__patient-status-label">Статус визита</span>\n                    <span class="visit-cards__patient-status-info">${this.status}</span>\n                </div>\n                <div class="visit-cards__patient-visit-date hide">\n                    <span class="visit-cards__patient-visit-date-label">Дата визита</span>\n                    <span class="visit-cards__patient-visit-date-info">${this.content.visitDate}</span>\n                </div>    \n                <button class="visit__btn-more">Подробнее о приеме <i class="zmdi zmdi-chevron-down"></i></button>\n                <div class="visit__options">\n                    <button class="visit__options--edit-btn options-btn">Редактировать</button>\n                </div>\n                <i class="fas fa-edit visit__options--btn-edit"></i>\n                <i class="fas fa-trash-alt visit__options--btn-delete"></i>\n            </div>\n        </div>`,i.prepend(e);e.querySelector(".visit__btn-more").addEventListener("click",()=>this.showMore());const a=e.querySelector(".visit__options--btn-edit");a.addEventListener("click",()=>this.showOptions(a));e.querySelector(".visit__options--btn-delete").addEventListener("click",()=>this.deleteVisit());e.querySelector(".visit__options--edit-btn").addEventListener("click",()=>{this.editVisit(),document.body.classList.add("scroll-hidden")}),"Завершен"===this.status&&this._visitCard.classList.add("finished");const d=this._visitCard.querySelector(".visit-cards__doctor");"Кардиолог"===this.doctor&&d.classList.add("visit-cards__doctor--red"),"Дантист"===this.doctor&&d.classList.add("visit-cards__doctor--blue"),"Терапевт"===this.doctor&&d.classList.add("visit-cards__doctor--green")}showMoreMain(){this._visitCard.querySelector(".visit-cards__patient-title").classList.remove("hide"),this._visitCard.querySelector(".visit-cards__patient-description").classList.remove("hide"),this._visitCard.querySelector(".visit-cards__patient-status").classList.remove("hide"),this._visitCard.querySelector(".visit-cards__patient-priority").classList.remove("hide"),this._visitCard.querySelector(".visit-cards__patient-visit-date").classList.remove("hide");const t=this._visitCard.querySelector(".visit__btn-more");t.classList.add("hidden");const i=document.createElement("button");i.classList.add("visit__btn-less"),i.innerHTML='Скрыть подробности <i class="zmdi zmdi-chevron-up"></i>',i.addEventListener("click",()=>this.showLess(t,i)),this._visitCard.append(i)}showLess(t,i){i.remove(),this._visitCard.querySelector(".visit__more-info").remove(),t.classList.remove("hidden"),this._visitCard.querySelector(".visit-cards__patient-title").classList.add("hide"),this._visitCard.querySelector(".visit-cards__patient-description").classList.add("hide"),this._visitCard.querySelector(".visit-cards__patient-status").classList.add("hide"),this._visitCard.querySelector(".visit-cards__patient-priority").classList.add("hide"),this._visitCard.querySelector(".visit-cards__patient-visit-date").classList.add("hide")}showOptions(t){t.classList.toggle("visit__options-btn--active");this._visitCard.querySelectorAll(".options-btn").forEach(t=>t.classList.toggle("btn_active"))}deleteVisit(){deleteCard(this.id).then(()=>{this._visitCard.remove()}),this._visitCard.remove()}editVisit(){const t=document.querySelector(".modal");return t.style.display="block",t}static renderAllCards(t){document.querySelectorAll(".visit-cards").forEach(t=>{t.remove()})}}export default Visit;