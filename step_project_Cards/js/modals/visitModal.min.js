import{Element}from"../forms/components/index.js";import{Input}from"../forms/components/index.js";import{CardioForm,DentistForm,TherapistForm}from"../forms/indexForms.js";import Modal from"./modal.js";import renderCards from"../script.js";import{saveVisitOnBase}from"../ajax/ajax.js";class VisitModal extends Modal{select={tag:"select",name:"doctor",class:"modal-window__doctors",label:"Выберите врача",options:{none:"Выберите врача",cardio:"Кардиолог",dentist:"Дантист",therapist:"Терапевт"},handler:{event:"change",func:function(e){let t=this.value;const n=(new CardioForm).render(),r=(new TherapistForm).render(),s=(new DentistForm).render();switch(t){case"Кардиолог":this.nextElementSibling&&this.nextElementSibling.remove(),this.after(n),this.setAttribute("form","cardio");break;case"Терапевт":this.nextElementSibling&&this.nextElementSibling.remove(),this.after(r),this.setAttribute("form","therapist");break;case"Дантист":this.nextElementSibling&&this.nextElementSibling.remove(),this.after(s),this.setAttribute("form","dentist");break;default:this.nextElementSibling&&this.nextElementSibling.remove();const e=new Element({tag:"span",class:"warning",content:"выберите врача"}).render();this.after(e)}}}};title={tag:"h3",class:"modal-window__title",content:"Создание визита"};render(){const{select:e,title:t}=this,n=super.render(),r=new Input(e);return n.append(new Element(t).render(),r.render()),r.handler(),n.classList.add("visit-modal"),n.addEventListener("submit",(async function(e){e.preventDefault();let t={};this.querySelectorAll("input, textarea, select").forEach(e=>{t[e.name]=e.value}),this.closest("#create-modal-window").style.display="none",this.querySelector('[name="doctor"]').value="Выберите врача",this.querySelector("form").remove();const r=await saveVisitOnBase(t);renderCards(r),document.body.classList.remove("scroll-hidden"),n.remove()})),n}}export default VisitModal;